<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>學生作業檢查程式</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .date {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .control-panel {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .student-count-section {
            flex: 1;
            min-width: 250px;
        }

        .homework-section {
            flex: 2;
            min-width: 300px;
        }

        .query-section {
            flex: 1;
            min-width: 250px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-left: 4px solid #4facfe;
            padding-left: 10px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        input, select, button {
            padding: 10px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
        }

        .homework-list {
            margin-top: 20px;
        }

        .homework-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .homework-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .homework-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .homework-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .homework-actions {
            display: flex;
            gap: 10px;
        }

        .student-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .student-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #e1e8ed;
            background: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .student-btn:hover {
            transform: scale(1.1);
        }

        .student-btn.submitted {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            border-color: #00b894;
        }

        .student-btn.needs-correction {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
            border-color: #e17055;
        }

        .bottom-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e1e8ed;
        }

        .watermark {
            font-size: 0.9rem;
            color: #6c757d;
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .status-legend {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #e1e8ed;
        }

        .legend-circle.submitted {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            border-color: #00b894;
        }

        .legend-circle.needs-correction {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            border-color: #e17055;
        }

        .query-results {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }

        .result-item {
            padding: 8px 0;
            border-bottom: 1px solid #e1e8ed;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .control-panel {
                flex-direction: column;
            }
            
            .student-buttons {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }
            
            .student-btn {
                width: 60px;
                height: 60px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>學生作業檢查程式</h1>
            <div class="date" id="currentDate"></div>
        </div>
        
        <div class="main-content">
            <div class="control-panel">
                <div class="student-count-section">
                    <div class="section-title">學生人數設定</div>
                    <div class="input-group">
                        <input type="number" id="studentCount" placeholder="輸入學生人數" min="1" max="50" value="30">
                        <button onclick="setStudentCount()">設定</button>
                    </div>
                    
                    <div class="status-legend">
                        <div class="legend-item">
                            <div class="legend-circle"></div>
                            <span>未繳交</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-circle submitted"></div>
                            <span>已繳交</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-circle needs-correction"></div>
                            <span>需要訂正</span>
                        </div>
                    </div>
                </div>
                
                <div class="homework-section">
                    <div class="section-title">作業管理</div>
                    <div class="input-group">
                        <input type="text" id="homeworkName" placeholder="輸入作業名稱">
                        <button onclick="addHomework()">新增作業</button>
                    </div>
                </div>
                
                <div class="query-section">
                    <div class="section-title">查詢功能</div>
                    <div class="input-group">
                        <select id="queryType">
                            <option value="date">依日期查詢</option>
                            <option value="student">依座號查詢</option>
                        </select>
                        <button onclick="showQueryModal()">查詢</button>
                    </div>
                </div>
            </div>
            
            <div class="homework-list" id="homeworkList"></div>
            
            <div class="bottom-controls">
                <div class="watermark">文君製作</div>
                <div>
                    <button onclick="saveToSheet()" style="margin-right: 10px;">儲存至試算表</button>
                    <button onclick="resetHomework()" class="btn-warning">重置作業</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 查詢結果模態框 -->
    <div id="queryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQueryModal()">&times;</span>
            <h2>查詢結果</h2>
            <div id="queryForm"></div>
            <div id="queryResults" class="query-results"></div>
        </div>
    </div>

    <!-- 編輯作業模態框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>編輯作業</h2>
            <div class="input-group">
                <input type="text" id="editHomeworkName" placeholder="作業名稱">
                <button onclick="updateHomework()">更新</button>
            </div>
        </div>
    </div>

    <script>
        let studentCount = 30;
        let homeworks = [];
        let currentEditingHomework = null;
        let homeworkData = {}; // 儲存所有作業繳交狀況

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            setStudentCount();
        });

        function updateDate() {
            const today = new Date();
            const formattedDate = today.getFullYear() + '/' + 
                                String(today.getMonth() + 1).padStart(2, '0') + '/' + 
                                String(today.getDate()).padStart(2, '0');
            document.getElementById('currentDate').textContent = formattedDate;
        }

        function setStudentCount() {
            const count = parseInt(document.getElementById('studentCount').value);
            if (count > 0 && count <= 50) {
                studentCount = count;
                renderHomeworks();
            } else {
                alert('請輸入1-50之間的學生人數');
            }
        }

        function addHomework() {
            const homeworkName = document.getElementById('homeworkName').value.trim();
            if (!homeworkName) {
                alert('請輸入作業名稱');
                return;
            }
            
            const homework = {
                id: Date.now(),
                name: homeworkName,
                date: new Date().toLocaleDateString('zh-TW')
            };
            
            homeworks.push(homework);
            homeworkData[homework.id] = {};
            
            for (let i = 1; i <= studentCount; i++) {
                homeworkData[homework.id][i] = 'not_submitted';
            }
            
            document.getElementById('homeworkName').value = '';
            renderHomeworks();
        }

        function renderHomeworks() {
            const container = document.getElementById('homeworkList');
            container.innerHTML = '';
            
            homeworks.forEach(homework => {
                const homeworkDiv = document.createElement('div');
                homeworkDiv.className = 'homework-item';
                homeworkDiv.innerHTML = `
                    <div class="homework-header">
                        <div class="homework-title">${homework.name} (${homework.date})</div>
                        <div class="homework-actions">
                            <button onclick="editHomework(${homework.id})" class="btn-warning">修改</button>
                            <button onclick="deleteHomework(${homework.id})" class="btn-danger">刪除</button>
                        </div>
                    </div>
                    <div class="student-buttons">
                        ${generateStudentButtons(homework.id)}
                    </div>
                `;
                container.appendChild(homeworkDiv);
            });
        }

        function generateStudentButtons(homeworkId) {
            let buttons = '';
            for (let i = 1; i <= studentCount; i++) {
                const status = homeworkData[homeworkId] ? homeworkData[homeworkId][i] || 'not_submitted' : 'not_submitted';
                const statusClass = status === 'submitted' ? 'submitted' : 
                                  status === 'needs_correction' ? 'needs-correction' : '';
                buttons += `<button class="student-btn ${statusClass}" 
                           onclick="toggleStudentStatus(${homeworkId}, ${i})">${i}</button>`;
            }
            return buttons;
        }

        function toggleStudentStatus(homeworkId, studentId) {
            if (!homeworkData[homeworkId]) {
                homeworkData[homeworkId] = {};
            }
            
            const currentStatus = homeworkData[homeworkId][studentId] || 'not_submitted';
            let newStatus;
            
            switch (currentStatus) {
                case 'not_submitted':
                    newStatus = 'submitted';
                    break;
                case 'submitted':
                    newStatus = 'needs_correction';
                    break;
                case 'needs_correction':
                    newStatus = 'not_submitted';
                    break;
                default:
                    newStatus = 'submitted';
            }
            
            homeworkData[homeworkId][studentId] = newStatus;
            renderHomeworks();
        }

        function editHomework(homeworkId) {
            const homework = homeworks.find(h => h.id === homeworkId);
            if (homework) {
                currentEditingHomework = homeworkId;
                document.getElementById('editHomeworkName').value = homework.name;
                document.getElementById('editModal').style.display = 'block';
            }
        }

        function updateHomework() {
            const newName = document.getElementById('editHomeworkName').value.trim();
            if (!newName) {
                alert('請輸入作業名稱');
                return;
            }
            
            const homework = homeworks.find(h => h.id === currentEditingHomework);
            if (homework) {
                homework.name = newName;
                renderHomeworks();
                closeEditModal();
            }
        }

        function deleteHomework(homeworkId) {
            if (confirm('確定要刪除這項作業嗎？')) {
                homeworks = homeworks.filter(h => h.id !== homeworkId);
                delete homeworkData[homeworkId];
                renderHomeworks();
            }
        }

        function resetHomework() {
            if (confirm('確定要重置所有作業的繳交狀況嗎？')) {
                Object.keys(homeworkData).forEach(homeworkId => {
                    for (let i = 1; i <= studentCount; i++) {
                        homeworkData[homeworkId][i] = 'not_submitted';
                    }
                });
                renderHomeworks();
            }
        }

        function showQueryModal() {
            const queryType = document.getElementById('queryType').value;
            const modal = document.getElementById('queryModal');
            const queryForm = document.getElementById('queryForm');
            
            if (queryType === 'date') {
                queryForm.innerHTML = `
                    <div class="input-group">
                        <input type="date" id="queryDate">
                        <button onclick="queryByDate()">查詢</button>
                    </div>
                `;
            } else {
                queryForm.innerHTML = `
                    <div class="input-group">
                        <input type="number" id="queryStudent" placeholder="輸入座號" min="1" max="${studentCount}">
                        <button onclick="queryByStudent()">查詢</button>
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }

        function queryByDate() {
            const queryDate = document.getElementById('queryDate').value;
            if (!queryDate) {
                alert('請選擇查詢日期');
                return;
            }
            
            const formattedDate = new Date(queryDate).toLocaleDateString('zh-TW');
            const results = [];
            
            homeworks.forEach(homework => {
                if (homework.date === formattedDate) {
                    for (let i = 1; i <= studentCount; i++) {
                        const status = homeworkData[homework.id] ? homeworkData[homework.id][i] : 'not_submitted';
                        const statusText = getStatusText(status);
                        results.push({
                            student: i,
                            homework: homework.name,
                            status: statusText
                        });
                    }
                }
            });
            
            displayQueryResults(results);
        }

        function queryByStudent() {
            const studentId = parseInt(document.getElementById('queryStudent').value);
            if (!studentId || studentId < 1 || studentId > studentCount) {
                alert('請輸入有效的座號');
                return;
            }
            
            const results = [];
            
            homeworks.forEach(homework => {
                const status = homeworkData[homework.id] ? homeworkData[homework.id][studentId] : 'not_submitted';
                const statusText = getStatusText(status);
                results.push({
                    homework: homework.name,
                    date: homework.date,
                    status: statusText
                });
            });
            
            displayQueryResults(results);
        }

        function displayQueryResults(results) {
            const container = document.getElementById('queryResults');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="result-item">沒有找到相關資料</div>';
                return;
            }
            
            let html = '';
            results.forEach(result => {
                if (result.student) {
                    html += `<div class="result-item">座號 ${result.student} - ${result.homework} - ${result.status}</div>`;
                } else {
                    html += `<div class="result-item">${result.homework} (${result.date}) - ${result.status}</div>`;
                }
            });
            
            container.innerHTML = html;
        }

        function getStatusText(status) {
            switch (status) {
                case 'submitted':
                    return '已繳交';
                case 'needs_correction':
                    return '需要訂正';
                default:
                    return '未繳交';
            }
        }

        function saveToSheet() {
            // 準備要儲存到試算表的資料
            const sheetData = [];
            
            homeworks.forEach(homework => {
                for (let i = 1; i <= studentCount; i++) {
                    const status = homeworkData[homework.id] ? homeworkData[homework.id][i] : 'not_submitted';
                    const statusText = getStatusText(status);
                    
                    sheetData.push({
                        座號: i,
                        日期: homework.date,
                        作業名稱: homework.name,
                        繳交狀況: statusText
                    });
                }
            });
            
            // 模擬儲存到試算表
            console.log('儲存到試算表的資料:', sheetData);
            
            // 由於無法直接存取Google Sheets API，這裡提供資料格式供參考
            const csvContent = "座號,日期,作業名稱,繳交狀況\n" + 
                             sheetData.map(row => `${row.座號},${row.日期},${row.作業名稱},${row.繳交狀況}`).join('\n');
            
            // 創建下載連結
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', '學生作業檢查資料.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('資料已匯出為CSV檔案，您可以將此檔案匯入Google試算表');
        }

        function closeQueryModal() {
            document.getElementById('queryModal').style.display = 'none';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingHomework = null;
        }

        // 點擊模態框外部關閉
        window.onclick = function(event) {
            const queryModal = document.getElementById('queryModal');
            const editModal = document.getElementById('editModal');
            if (event.target == queryModal) {
                closeQueryModal();
            }
            if (event.target == editModal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>